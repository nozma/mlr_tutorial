<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>mlrパッケージチュートリアル</title>
  <meta name="description" content="mlrパッケージチュートリアル">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="mlrパッケージチュートリアル" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="mlrパッケージチュートリアル" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="section-6.html">
<link rel="next" href="section-8.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="1" data-path="quick-start.html"><a href="quick-start.html"><i class="fa fa-check"></i><b>1</b> Quick start</a><ul>
<li class="chapter" data-level="1.1" data-path="quick-start.html"><a href="quick-start.html#section-1.1"><i class="fa fa-check"></i><b>1.1</b> タスクの定義</a></li>
<li class="chapter" data-level="1.2" data-path="quick-start.html"><a href="quick-start.html#section-1.2"><i class="fa fa-check"></i><b>1.2</b> 学習器の定義</a></li>
<li class="chapter" data-level="1.3" data-path="quick-start.html"><a href="quick-start.html#section-1.3"><i class="fa fa-check"></i><b>1.3</b> (データを訓練セットとテストセットに分割する)</a></li>
<li class="chapter" data-level="1.4" data-path="quick-start.html"><a href="quick-start.html#section-1.4"><i class="fa fa-check"></i><b>1.4</b> 訓練</a></li>
<li class="chapter" data-level="1.5" data-path="quick-start.html"><a href="quick-start.html#section-1.5"><i class="fa fa-check"></i><b>1.5</b> 予測</a></li>
<li class="chapter" data-level="1.6" data-path="quick-start.html"><a href="quick-start.html#section-1.6"><i class="fa fa-check"></i><b>1.6</b> 評価</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-2.html"><a href="section-2.html"><i class="fa fa-check"></i><b>2</b> タスク</a><ul>
<li class="chapter" data-level="2.1" data-path="section-2.html"><a href="section-2.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> タスクの種類と作成</a><ul>
<li class="chapter" data-level="2.1.1" data-path="section-2.html"><a href="section-2.html#section-2.1.1"><i class="fa fa-check"></i><b>2.1.1</b> 回帰</a></li>
<li class="chapter" data-level="2.1.2" data-path="section-2.html"><a href="section-2.html#section-2.1.2"><i class="fa fa-check"></i><b>2.1.2</b> 分類</a></li>
<li class="chapter" data-level="2.1.3" data-path="section-2.html"><a href="section-2.html#section-2.1.3"><i class="fa fa-check"></i><b>2.1.3</b> 生存時間分析</a></li>
<li class="chapter" data-level="2.1.4" data-path="section-2.html"><a href="section-2.html#section-2.1.4"><i class="fa fa-check"></i><b>2.1.4</b> マルチラベル分類</a></li>
<li class="chapter" data-level="2.1.5" data-path="section-2.html"><a href="section-2.html#section-2.1.5"><i class="fa fa-check"></i><b>2.1.5</b> クラスター分析</a></li>
<li class="chapter" data-level="2.1.6" data-path="section-2.html"><a href="section-2.html#section-2.1.6"><i class="fa fa-check"></i><b>2.1.6</b> コスト考慮型分類</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="section-2.html"><a href="section-2.html#section-2.2"><i class="fa fa-check"></i><b>2.2</b> その他の設定</a></li>
<li class="chapter" data-level="2.3" data-path="section-2.html"><a href="section-2.html#section-2.3"><i class="fa fa-check"></i><b>2.3</b> タスクへのアクセス</a></li>
<li class="chapter" data-level="2.4" data-path="section-2.html"><a href="section-2.html#section-2.4"><i class="fa fa-check"></i><b>2.4</b> タスクの編集</a></li>
<li class="chapter" data-level="2.5" data-path="section-2.html"><a href="section-2.html#section-2.5"><i class="fa fa-check"></i><b>2.5</b> タスクの例と便利な関数</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-3.html"><a href="section-3.html"><i class="fa fa-check"></i><b>3</b> 学習器</a><ul>
<li class="chapter" data-level="3.1" data-path="section-3.html"><a href="section-3.html#section-3.1"><i class="fa fa-check"></i><b>3.1</b> 学習器を構築する</a></li>
<li class="chapter" data-level="3.2" data-path="section-3.html"><a href="section-3.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 学習器へアクセスする</a></li>
<li class="chapter" data-level="3.3" data-path="section-3.html"><a href="section-3.html#section-3.3"><i class="fa fa-check"></i><b>3.3</b> 学習器の編集</a></li>
<li class="chapter" data-level="3.4" data-path="section-3.html"><a href="section-3.html#section-3.4"><i class="fa fa-check"></i><b>3.4</b> 学習器一覧</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-4.html"><a href="section-4.html"><i class="fa fa-check"></i><b>4</b> 学習器の訓練</a><ul>
<li class="chapter" data-level="4.1" data-path="section-4.html"><a href="section-4.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 学習器モデルへのアクセス</a></li>
<li class="chapter" data-level="4.2" data-path="section-4.html"><a href="section-4.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> その他のオプションとコメント</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="-1.html"><a href="-1.html"><i class="fa fa-check"></i><b>5</b> 予測</a><ul>
<li class="chapter" data-level="5.1" data-path="-1.html"><a href="-1.html#section-5.1"><i class="fa fa-check"></i><b>5.1</b> 新しいデータに対する結果を予測する</a></li>
<li class="chapter" data-level="5.2" data-path="-1.html"><a href="-1.html#section-5.2"><i class="fa fa-check"></i><b>5.2</b> 予測へのアクセス</a></li>
<li class="chapter" data-level="5.3" data-path="-1.html"><a href="-1.html#-"><i class="fa fa-check"></i><b>5.3</b> 回帰: 標準誤差を取得する</a></li>
<li class="chapter" data-level="5.4" data-path="-1.html"><a href="-1.html#-"><i class="fa fa-check"></i><b>5.4</b> 分類とクラスタリング: 確率を取得する</a></li>
<li class="chapter" data-level="5.5" data-path="-1.html"><a href="-1.html#-"><i class="fa fa-check"></i><b>5.5</b> 分類: 混同行列を取得する</a></li>
<li class="chapter" data-level="5.6" data-path="-1.html"><a href="-1.html#-"><i class="fa fa-check"></i><b>5.6</b> 分類: 決定閾値の調整</a></li>
<li class="chapter" data-level="5.7" data-path="-1.html"><a href="-1.html#section-5.7"><i class="fa fa-check"></i><b>5.7</b> 予測の可視化</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-6.html"><a href="section-6.html"><i class="fa fa-check"></i><b>6</b> データの前処理</a><ul>
<li class="chapter" data-level="6.1" data-path="section-6.html"><a href="section-6.html#section-6.1"><i class="fa fa-check"></i><b>6.1</b> 前処理と学習器を融合する</a></li>
<li class="chapter" data-level="6.2" data-path="section-6.html"><a href="section-6.html#makepreprocwrappercaret"><i class="fa fa-check"></i><b>6.2</b> <code>makePreprocWrapperCaret</code>を使用した前処理</a></li>
<li class="chapter" data-level="6.3" data-path="section-6.html"><a href="section-6.html#section-6.3"><i class="fa fa-check"></i><b>6.3</b> 前処理オプションと学習器パラメータの連結チューニング</a></li>
<li class="chapter" data-level="6.4" data-path="section-6.html"><a href="section-6.html#section-6.4"><i class="fa fa-check"></i><b>6.4</b> 独自の前処理ラッパーを書く</a><ul>
<li class="chapter" data-level="6.4.1" data-path="section-6.html"><a href="section-6.html#section-6.4.1"><i class="fa fa-check"></i><b>6.4.1</b> 訓練関数の指定</a></li>
<li class="chapter" data-level="6.4.2" data-path="section-6.html"><a href="section-6.html#section-6.4.2"><i class="fa fa-check"></i><b>6.4.2</b> 予測関数の指定</a></li>
<li class="chapter" data-level="6.4.3" data-path="section-6.html"><a href="section-6.html#section-6.4.3"><i class="fa fa-check"></i><b>6.4.3</b> 前処理ラッパーの作成</a></li>
<li class="chapter" data-level="6.4.4" data-path="section-6.html"><a href="section-6.html#section-6.4.4"><i class="fa fa-check"></i><b>6.4.4</b> 前処理と学習器のパラメータを連結してチューニングする</a></li>
<li class="chapter" data-level="6.4.5" data-path="section-6.html"><a href="section-6.html#section-6.4.5"><i class="fa fa-check"></i><b>6.4.5</b> 前処理ラッパー関数</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-7.html"><a href="section-7.html"><i class="fa fa-check"></i><b>7</b> 学習器の性能を評価する</a><ul>
<li class="chapter" data-level="7.1" data-path="section-7.html"><a href="section-7.html#section-7.1"><i class="fa fa-check"></i><b>7.1</b> 利用可能な性能指標</a></li>
<li class="chapter" data-level="7.2" data-path="section-7.html"><a href="section-7.html#section-7.2"><i class="fa fa-check"></i><b>7.2</b> 指標の一覧</a></li>
<li class="chapter" data-level="7.3" data-path="section-7.html"><a href="section-7.html#section-7.3"><i class="fa fa-check"></i><b>7.3</b> 性能指標を計算する</a></li>
<li class="chapter" data-level="7.4" data-path="section-7.html"><a href="section-7.html#section-7.4"><i class="fa fa-check"></i><b>7.4</b> 指標計算に必要な情報</a></li>
<li class="chapter" data-level="7.5" data-path="section-7.html"><a href="section-7.html#section-7.5"><i class="fa fa-check"></i><b>7.5</b> 性能指標へのアクセス</a></li>
<li class="chapter" data-level="7.6" data-path="section-7.html"><a href="section-7.html#section-7.6"><i class="fa fa-check"></i><b>7.6</b> 2クラス分類</a><ul>
<li class="chapter" data-level="7.6.1" data-path="section-7.html"><a href="section-7.html#section-7.6.1"><i class="fa fa-check"></i><b>7.6.1</b> 性能と閾値の関係をプロットする</a></li>
<li class="chapter" data-level="7.6.2" data-path="section-7.html"><a href="section-7.html#roc"><i class="fa fa-check"></i><b>7.6.2</b> ROC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-8.html"><a href="section-8.html"><i class="fa fa-check"></i><b>8</b> リサンプリング</a><ul>
<li class="chapter" data-level="8.1" data-path="section-8.html"><a href="section-8.html#section-8.1"><i class="fa fa-check"></i><b>8.1</b> リサンプリング手法を決める</a></li>
<li class="chapter" data-level="8.2" data-path="section-8.html"><a href="section-8.html#section-8.2"><i class="fa fa-check"></i><b>8.2</b> リサンプリングを実行する</a></li>
<li class="chapter" data-level="8.3" data-path="section-8.html"><a href="section-8.html#section-8.3"><i class="fa fa-check"></i><b>8.3</b> リサンプル結果へのアクセス</a><ul>
<li class="chapter" data-level="8.3.1" data-path="section-8.html"><a href="section-8.html#section-8.3.1"><i class="fa fa-check"></i><b>8.3.1</b> 予測値</a></li>
<li class="chapter" data-level="8.3.2" data-path="section-8.html"><a href="section-8.html#section-8.3.2"><i class="fa fa-check"></i><b>8.3.2</b> 訓練済みモデルの抽出</a></li>
<li class="chapter" data-level="8.3.3" data-path="section-8.html"><a href="section-8.html#section-8.3.3"><i class="fa fa-check"></i><b>8.3.3</b> 他の抽出方法</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="section-8.html"><a href="section-8.html#section-8.4"><i class="fa fa-check"></i><b>8.4</b> 階層化とブロック化</a><ul>
<li class="chapter" data-level="8.4.1" data-path="section-8.html"><a href="section-8.html#section-8.4.1"><i class="fa fa-check"></i><b>8.4.1</b> 目的変数の階層化</a></li>
<li class="chapter" data-level="8.4.2" data-path="section-8.html"><a href="section-8.html#section-8.4.2"><i class="fa fa-check"></i><b>8.4.2</b> 説明変数の階層化</a></li>
<li class="chapter" data-level="8.4.3" data-path="section-8.html"><a href="section-8.html#section-8.4.3"><i class="fa fa-check"></i><b>8.4.3</b> ブロック化</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="section-8.html"><a href="section-8.html#section-8.5"><i class="fa fa-check"></i><b>8.5</b> リサンプリングの詳細とリサンプルのインスタンス</a></li>
<li class="chapter" data-level="8.6" data-path="section-8.html"><a href="section-8.html#section-8.6"><i class="fa fa-check"></i><b>8.6</b> 性能指標の集約</a><ul>
<li class="chapter" data-level="8.6.1" data-path="-1.html"><a href="-1.html#-"><i class="fa fa-check"></i><b>8.6.1</b> 例: 一つの指標に複数の集約方法</a></li>
<li class="chapter" data-level="8.6.2" data-path="-1.html"><a href="-1.html#-"><i class="fa fa-check"></i><b>8.6.2</b> 例: 訓練セットの誤差を計算する</a></li>
<li class="chapter" data-level="8.6.3" data-path="-1.html"><a href="-1.html#-"><i class="fa fa-check"></i><b>8.6.3</b> 例: ブートストラップ</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="section-8.html"><a href="section-8.html#section-8.7"><i class="fa fa-check"></i><b>8.7</b> 便利な関数</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="section-9.html"><a href="section-9.html"><i class="fa fa-check"></i><b>9</b> ハイパーパラメータのチューニング</a><ul>
<li class="chapter" data-level="9.1" data-path="section-9.html"><a href="section-9.html#section-9.1"><i class="fa fa-check"></i><b>9.1</b> パラメータ探索空間の指定</a></li>
<li class="chapter" data-level="9.2" data-path="section-9.html"><a href="section-9.html#section-9.2"><i class="fa fa-check"></i><b>9.2</b> 最適化アルゴリズムの指定</a></li>
<li class="chapter" data-level="9.3" data-path="section-9.html"><a href="section-9.html#section-9.3"><i class="fa fa-check"></i><b>9.3</b> チューニングの実行</a></li>
<li class="chapter" data-level="9.4" data-path="section-9.html"><a href="section-9.html#section-9.4"><i class="fa fa-check"></i><b>9.4</b> チューニング結果へのアクセス</a></li>
<li class="chapter" data-level="9.5" data-path="section-9.html"><a href="section-9.html#section-9.5"><i class="fa fa-check"></i><b>9.5</b> ハイパーパラメータチューニングの影響を調査する</a></li>
<li class="chapter" data-level="9.6" data-path="section-9.html"><a href="section-9.html#section-9.6"><i class="fa fa-check"></i><b>9.6</b> その他いろいろ</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="section-10.html"><a href="section-10.html"><i class="fa fa-check"></i><b>10</b> ベンチマーク試験</a><ul>
<li class="chapter" data-level="10.1" data-path="section-10.html"><a href="section-10.html#section-10.1"><i class="fa fa-check"></i><b>10.1</b> ベンチマーク試験の実施</a><ul>
<li class="chapter" data-level="10.1.1" data-path="section-10.html"><a href="section-10.html#section-10.1.1"><i class="fa fa-check"></i><b>10.1.1</b> 実験を再現可能にする</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="section-10.html"><a href="section-10.html#section-10.2"><i class="fa fa-check"></i><b>10.2</b> ベンチマーク結果へのアクセス</a><ul>
<li class="chapter" data-level="10.2.1" data-path="section-10.html"><a href="section-10.html#section-10.2.1"><i class="fa fa-check"></i><b>10.2.1</b> 学習器の性能</a></li>
<li class="chapter" data-level="10.2.2" data-path="section-10.html"><a href="section-10.html#-2"><i class="fa fa-check"></i><b>10.2.2</b> 予測</a></li>
<li class="chapter" data-level="10.2.3" data-path="section-10.html"><a href="section-10.html#id"><i class="fa fa-check"></i><b>10.2.3</b> ID</a></li>
<li class="chapter" data-level="10.2.4" data-path="section-10.html"><a href="section-10.html#section-10.2.4"><i class="fa fa-check"></i><b>10.2.4</b> フィット済みモデル</a></li>
<li class="chapter" data-level="10.2.5" data-path="section-10.html"><a href="section-10.html#section-10.2.5"><i class="fa fa-check"></i><b>10.2.5</b> 学習器と性能指標</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="section-10.html"><a href="section-10.html#section-10.3"><i class="fa fa-check"></i><b>10.3</b> ベンチマーク結果のマージ</a></li>
<li class="chapter" data-level="10.4" data-path="section-10.html"><a href="section-10.html#section-10.4"><i class="fa fa-check"></i><b>10.4</b> ベンチマークの分析と可視化</a><ul>
<li class="chapter" data-level="10.4.1" data-path="section-10.html"><a href="section-10.html#section-10.4.1"><i class="fa fa-check"></i><b>10.4.1</b> 例：線形判別分析と分類木、ランダムフォレストの比較</a></li>
<li class="chapter" data-level="10.4.2" data-path="section-10.html"><a href="section-10.html#section-10.4.2"><i class="fa fa-check"></i><b>10.4.2</b> 可視化</a></li>
<li class="chapter" data-level="10.4.3" data-path="section-10.html"><a href="section-10.html#section-10.4.3"><i class="fa fa-check"></i><b>10.4.3</b> 集約結果の可視化</a></li>
<li class="chapter" data-level="10.4.4" data-path="section-10.html"><a href="section-10.html#section-10.4.4"><i class="fa fa-check"></i><b>10.4.4</b> 順位の計算と可視化</a></li>
<li class="chapter" data-level="10.4.5" data-path="section-10.html"><a href="section-10.html#section-10.4.5"><i class="fa fa-check"></i><b>10.4.5</b> 仮説検定で学習器を比較する</a></li>
<li class="chapter" data-level="10.4.6" data-path="section-10.html"><a href="section-10.html#section-10.4.6"><i class="fa fa-check"></i><b>10.4.6</b> 臨界差ダイアグラム</a></li>
<li class="chapter" data-level="10.4.7" data-path="section-10.html"><a href="section-10.html#section-10.4.7"><i class="fa fa-check"></i><b>10.4.7</b> プロットの調整</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="section-10.html"><a href="section-10.html#section-10.5"><i class="fa fa-check"></i><b>10.5</b> その他のコメント</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">mlrパッケージチュートリアル</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-7" class="section level1">
<h1><span class="header-section-number">Section 7</span> 学習器の性能を評価する</h1>
<p><code>mlr</code>には学習機の予測性能について様々な側面から評価する方法が備えられている。性能指標を計算するためには、<code>predict</code>の返すオブジェクトと目的の性能指標を指定して<code>performance</code>関数を呼び出す。</p>
<div id="section-7.1" class="section level2">
<h2><span class="header-section-number">7.1</span> 利用可能な性能指標</h2>
<p><code>mlr</code>はすべての種類の学習問題に対して多数の性能指標を提供している。分類問題に対する典型的な性能指標としては、平均誤分類率(mmce)、精度(acc)、ROC曲線などが使える。回帰問題に対しては、平均二乗偏差(mse)、平均絶対誤差(mae)などが一般に使用される。他にもクラスタリング問題では、Dunn Index(dunn)が、生存時間分析に対してはConcordance Index(cindex)が、コスト考慮型予測問題ではMisclassification Penalty(mcp)など、様々な指標が利用可能である。また、訓練にかかった時間(timetrain)、予測にかかった時間(timepredict)、その合計(timeboth)も性能指標の一つとしてアクセスできる。</p>
<p>どのような指標が実装されているかについては、<a href="https://mlr-org.github.io/mlr-tutorial/devel/html/measures/index.html">Implemented Performance Measures - mlr tutorial</a>および<a href="https://www.rdocumentation.org/packages/mlr/versions/2.10/topics/measures">measures function | R Documentation</a>を確認してもらいたい。</p>
<p>もし新たな指標を実装したり、標準的でない誤分類コストを指標に含めたいと思うのであれば、<a href="https://mlr-org.github.io/mlr-tutorial/devel/html/create_measure/index.html">Create Custom Measures - mlr tutorial</a>を見てもらいたい。</p>
</div>
<div id="section-7.2" class="section level2">
<h2><span class="header-section-number">7.2</span> 指標の一覧</h2>
<p>各指標の詳細については上述のImplemented Performance Measuresを確認してもらうとして、特定のプロパティを持つ指標や、特定のタスクに利用可能な指標を確認したければ<code>listMeasures</code>関数を使うと良い。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## 多クラス問題に対する分類指標
<span class="kw">listMeasures</span>(<span class="st">&quot;classif&quot;</span>, <span class="dt">properties =</span> <span class="st">&quot;classif.multi&quot;</span>)</code></pre></div>
<pre><code>$&gt;  [1] &quot;kappa&quot;            &quot;multiclass.brier&quot; &quot;multiclass.aunp&quot; 
$&gt;  [4] &quot;multiclass.aunu&quot;  &quot;qsr&quot;              &quot;ber&quot;             
$&gt;  [7] &quot;logloss&quot;          &quot;wkappa&quot;           &quot;timeboth&quot;        
$&gt; [10] &quot;timepredict&quot;      &quot;acc&quot;              &quot;lsr&quot;             
$&gt; [13] &quot;featperc&quot;         &quot;multiclass.au1p&quot;  &quot;multiclass.au1u&quot; 
$&gt; [16] &quot;ssr&quot;              &quot;timetrain&quot;        &quot;mmce&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## iris.taskに対する分類指標
<span class="kw">listMeasures</span>(iris.task)</code></pre></div>
<pre><code>$&gt;  [1] &quot;kappa&quot;            &quot;multiclass.brier&quot; &quot;multiclass.aunp&quot; 
$&gt;  [4] &quot;multiclass.aunu&quot;  &quot;qsr&quot;              &quot;ber&quot;             
$&gt;  [7] &quot;logloss&quot;          &quot;wkappa&quot;           &quot;timeboth&quot;        
$&gt; [10] &quot;timepredict&quot;      &quot;acc&quot;              &quot;lsr&quot;             
$&gt; [13] &quot;featperc&quot;         &quot;multiclass.au1p&quot;  &quot;multiclass.au1u&quot; 
$&gt; [16] &quot;ssr&quot;              &quot;timetrain&quot;        &quot;mmce&quot;</code></pre>
<p>簡便のため、それぞれの学習問題に対しては、よく使われる指標がデフォルトとして指定してある。例えば回帰では平均二乗偏差が、分類では平均誤分類率がデフォルトだ。何がデフォルトであるかは<code>getDefaultMeasure</code>関数を使うと確認できる。また、この関数のヘルプでデフォルトに使用される指標の一覧が確認できる。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## iris.taskのデフォルト指標
<span class="kw">getDefaultMeasure</span>(iris.task)</code></pre></div>
<pre><code>$&gt; Name: Mean misclassification error
$&gt; Performance measure: mmce
$&gt; Properties: classif,classif.multi,req.pred,req.truth
$&gt; Minimize: TRUE
$&gt; Best: 0; Worst: 1
$&gt; Aggregated by: test.mean
$&gt; Note: Defined as: mean(response != truth)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## 回帰のデフォルト指標
<span class="kw">getDefaultMeasure</span>(<span class="kw">makeLearner</span>(<span class="st">&quot;regr.lm&quot;</span>))</code></pre></div>
<pre><code>$&gt; Name: Mean of squared errors
$&gt; Performance measure: mse
$&gt; Properties: regr,req.pred,req.truth
$&gt; Minimize: TRUE
$&gt; Best: 0; Worst: Inf
$&gt; Aggregated by: test.mean
$&gt; Note: Defined as: mean((response - truth)^2)</code></pre>
</div>
<div id="section-7.3" class="section level2">
<h2><span class="header-section-number">7.3</span> 性能指標を計算する</h2>
<p>例として、勾配ブースティングマシンを<code>BostonHousing</code>データの一部に適用し、残りのデータから標準の性能指標である平均二乗偏差を計算してみよう。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n =<span class="st"> </span><span class="kw">getTaskSize</span>(bh.task)
lrn =<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;regr.gbm&quot;</span>, <span class="dt">n.trees =</span> <span class="dv">1000</span>)
mod =<span class="st"> </span><span class="kw">train</span>(lrn, <span class="dt">task =</span> bh.task, <span class="dt">subset =</span> <span class="kw">seq</span>(<span class="dv">1</span>, n, <span class="dv">2</span>))
pred =<span class="st"> </span><span class="kw">predict</span>(mod, <span class="dt">task =</span> bh.task, <span class="dt">subset =</span> <span class="kw">seq</span>(<span class="dv">2</span>, n, <span class="dv">2</span>))

<span class="kw">performance</span>(pred)</code></pre></div>
<pre><code>$&gt;      mse 
$&gt; 42.79453</code></pre>
<p>他の指標の例として中央値二乗誤差(medse)を求めてみよう。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">performance</span>(pred, <span class="dt">measures =</span> medse)</code></pre></div>
<pre><code>$&gt;    medse 
$&gt; 9.101212</code></pre>
<p>もちろん、独自に作成した指標も含めて、複数の指標を一度に計算することもできる。その場合、求めたい指標をリストにして渡す。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">performance</span>(pred, <span class="dt">measures =</span> <span class="kw">list</span>(mse, medse, mae))</code></pre></div>
<pre><code>$&gt;       mse     medse       mae 
$&gt; 42.794531  9.101212  4.556043</code></pre>
<p>上記の方法は、学習問題や性能指標の種類が異なっても基本的には同じである。</p>
</div>
<div id="section-7.4" class="section level2">
<h2><span class="header-section-number">7.4</span> 指標計算に必要な情報</h2>
<p>一部の性能指標では、計算のために予測結果だけでなく、タスクやフィット済みモデルも必要とする。</p>
<p>一例は訓練にかかった時間(timetrain)だ。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">performance</span>(pred, <span class="dt">measures =</span> timetrain, <span class="dt">model =</span> mod)</code></pre></div>
<pre><code>$&gt; timetrain 
$&gt;      0.34</code></pre>
<p>クラスター分析に関わる多くの性能指標はタスクを必要とする。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lrn =<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;cluster.kmeans&quot;</span>, <span class="dt">centers =</span> <span class="dv">3</span>)
mod =<span class="st"> </span><span class="kw">train</span>(lrn, mtcars.task)
pred =<span class="st"> </span><span class="kw">predict</span>(mod, <span class="dt">task =</span> mtcars.task)

<span class="kw">performance</span>(pred, <span class="dt">measures =</span> dunn, <span class="dt">task =</span> mtcars.task)</code></pre></div>
<pre><code>$&gt;      dunn 
$&gt; 0.1178415</code></pre>
<p>また、いくつかの指標は特定の種類の予測を必要とする。例えば2クラス分類におけるAUC(これはROC[receiver operating characteristic]曲線の下側の面積[Area Under Curve]である)を計算するためには、事後確率が必要である。ROC分析に関する詳細が必要であれば<a href="https://mlr-org.github.io/mlr-tutorial/devel/html/roc_analysis/index.html">ROC Analysis - mlr tutorial</a>を確認してほしい。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lrn =<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.rpart&quot;</span>, <span class="dt">predict.type =</span> <span class="st">&quot;prob&quot;</span>)
mod =<span class="st"> </span><span class="kw">train</span>(lrn, <span class="dt">task =</span> sonar.task)
pred =<span class="st"> </span><span class="kw">predict</span>(mod, <span class="dt">task =</span> sonar.task)

<span class="kw">performance</span>(pred, <span class="dt">measures =</span> auc)</code></pre></div>
<pre><code>$&gt;       auc 
$&gt; 0.9224018</code></pre>
<p>また、分類問題に利用可能な性能指標(偽陽性率fprなど)の多くは、2クラス分類のみに利用可能であるという点に注意してもらいたい。</p>
</div>
<div id="section-7.5" class="section level2">
<h2><span class="header-section-number">7.5</span> 性能指標へのアクセス</h2>
<p><code>mlr</code>における性能指標は<code>Measure</code>クラスのオブジェクトである。オブジェクトを通じて指標のプロパティ等には直接アクセスすることができる。各スロットに関する説明は<a href="https://www.rdocumentation.org/packages/mlr/versions/2.10/topics/makeMeasure">makeMeasure function | R Documentation</a>を確認してもらいたい。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(mmce)</code></pre></div>
<pre><code>$&gt; List of 10
$&gt;  $ id        : chr &quot;mmce&quot;
$&gt;  $ minimize  : logi TRUE
$&gt;  $ properties: chr [1:4] &quot;classif&quot; &quot;classif.multi&quot; &quot;req.pred&quot; &quot;req.truth&quot;
$&gt;  $ fun       :function (task, model, pred, feats, extra.args)  
$&gt;  $ extra.args: list()
$&gt;  $ best      : num 0
$&gt;  $ worst     : num 1
$&gt;  $ name      : chr &quot;Mean misclassification error&quot;
$&gt;  $ note      : chr &quot;Defined as: mean(response != truth)&quot;
$&gt;  $ aggr      :List of 4
$&gt;   ..$ id        : chr &quot;test.mean&quot;
$&gt;   ..$ name      : chr &quot;Test mean&quot;
$&gt;   ..$ fun       :function (task, perf.test, perf.train, measure, group, pred)  
$&gt;   ..$ properties: chr &quot;req.test&quot;
$&gt;   ..- attr(*, &quot;class&quot;)= chr &quot;Aggregation&quot;
$&gt;  - attr(*, &quot;class&quot;)= chr &quot;Measure&quot;</code></pre>
</div>
<div id="section-7.6" class="section level2">
<h2><span class="header-section-number">7.6</span> 2クラス分類</h2>
<div id="section-7.6.1" class="section level3">
<h3><span class="header-section-number">7.6.1</span> 性能と閾値の関係をプロットする</h3>
<p>2クラス分類問題においては、予測された確率からクラスラベルへの割り当てを行う際の確率の閾値を設定できるということを思い出してもらいたい。<code>generateThreshVsPrefData</code>と<code>plotThreshVsPref</code>は、学習器のパフォーマンスと閾値の関係をプロットできる便利な関数だ。</p>
<p>パフォーマンスのプロットと閾値の自動チューニングに関して詳しい情報は<a href="https://mlr-org.github.io/mlr-tutorial/devel/html/roc_analysis/index.html">ROC Analysis - mlr tutorial</a>を確認してほしい。</p>
<p>以下の例では、<code>Sonar</code>データセットを用い、偽陽性率(fpr)、偽陰性率(fnr)、平均誤分類率(mmce)を設定可能な範囲の閾値に対してプロットしている。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lrn =<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">&quot;classif.lda&quot;</span>, <span class="dt">predict.type =</span> <span class="st">&quot;prob&quot;</span>)
n =<span class="st"> </span><span class="kw">getTaskSize</span>(sonar.task)
mod =<span class="st"> </span><span class="kw">train</span>(lrn, <span class="dt">task =</span> sonar.task, <span class="dt">subset =</span> <span class="kw">seq</span>(<span class="dv">1</span>, n, <span class="dt">by =</span> <span class="dv">2</span>))
pred =<span class="st"> </span><span class="kw">predict</span>(mod, <span class="dt">task =</span> sonar.task, <span class="dt">subset =</span> <span class="kw">seq</span>(<span class="dv">2</span>, n, <span class="dt">by =</span> <span class="dv">2</span>))

d =<span class="st"> </span><span class="kw">generateThreshVsPerfData</span>(pred, <span class="dt">measures =</span> <span class="kw">list</span>(fpr, fnr, mmce))
<span class="kw">plotThreshVsPerf</span>(d)</code></pre></div>
<p><img src="mlr_tutorial_ja_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
<p><code>ggvis</code>を利用した<code>plotThreshVsPerfGGVIS</code>関数は、Shinyを使ったインタラクティブなグラフを生成する。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotThreshVsPerfGGVIS</span>(d)</code></pre></div>
</div>
<div id="roc" class="section level3">
<h3><span class="header-section-number">7.6.2</span> ROC</h3>
<p>2クラス分類においては、多数の分類指標が存在するが、これは1つの表としてまとめることができる。例えばROCに関するWikipediaのページ<a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">Receiver operating characteristic - Wikipedia</a>を見てもらいたい(訳注:日本語版の受信者操作特性のページには無い)。</p>
<p>これと同じようなものを<code>calculateROCMeasures</code>関数を用いると作成できる。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">calculateROCMeasures</span>(pred)</code></pre></div>
<pre><code>$&gt;     predicted
$&gt; true M         R                            
$&gt;    M 0.7       0.3       tpr: 0.7  fnr: 0.3 
$&gt;    R 0.25      0.75      fpr: 0.25 tnr: 0.75
$&gt;      ppv: 0.76 for: 0.32 lrp: 2.79 acc: 0.72
$&gt;      fdr: 0.24 npv: 0.68 lrm: 0.4  dor: 6.88
$&gt; 
$&gt; 
$&gt; Abbreviations:
$&gt; tpr - True positive rate (Sensitivity, Recall)
$&gt; fpr - False positive rate (Fall-out)
$&gt; fnr - False negative rate (Miss rate)
$&gt; tnr - True negative rate (Specificity)
$&gt; ppv - Positive predictive value (Precision)
$&gt; for - False omission rate
$&gt; lrp - Positive likelihood ratio (LR+)
$&gt; fdr - False discovery rate
$&gt; npv - Negative predictive value
$&gt; acc - Accuracy
$&gt; lrm - Negative likelihood ratio (LR-)
$&gt; dor - Diagnostic odds ratio</code></pre>
<p>左上の2x2行列は混同行列であり、正しく分類された観測値と誤分類された観測値の相対頻度を示している。また、その右側と下側には、混同行列から計算可能な多数の性能指標が示されている。また、デフォルトでは各項目に対する説明が追記されるが、これは<code>print</code>に<code>abbreviations = FALSE</code>を指定することで消すことも出来る。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">calculateROCMeasures</span>(pred), <span class="dt">abbreviations =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>$&gt;     predicted
$&gt; true M         R                            
$&gt;    M 0.7       0.3       tpr: 0.7  fnr: 0.3 
$&gt;    R 0.25      0.75      fpr: 0.25 tnr: 0.75
$&gt;      ppv: 0.76 for: 0.32 lrp: 2.79 acc: 0.72
$&gt;      fdr: 0.24 npv: 0.68 lrm: 0.4  dor: 6.88</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-6.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-8.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
